---
title: "Main"
author: "Michelle Gao"
date: "November 6, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F)

library(fs)
library(infer)
library(purrr)
library(tidyverse)

```

```{r setup_data}

# Read in the political ad data sets and filter for US information

ads <- read_csv("google-ads-data/google-political-ads-creative-stats.csv") %>% 
  filter(Regions == "US") %>% 
  select(Ad_ID, Ad_URL, Ad_Type, Advertiser_ID, Advertiser_Name, Ad_Campaigns_List, Date_Range_Start, Date_Range_End, Num_of_Days, Impressions, Spend_USD)

advertisers <- read_csv("google-ads-data/google-political-ads-advertiser-stats.csv") %>% 
  filter(Regions == "US") %>% 
  select(Advertiser_ID, Advertiser_Name, Public_IDs_List, Total_Creatives, Spend_USD)

# Probably deprecated
advertisers_weekly_spend <- read_csv("google-ads-data/google-political-ads-advertiser-weekly-spend.csv")

# Probably won't use
ad_campaigns <- read_csv("google-ads-data/google-political-ads-campaign-targeting.csv")
geo_spend <- read_csv("google-ads-data/google-political-ads-geo-spend.csv")
keywords <- read_csv("google-ads-data/google-political-ads-top-keywords-history.csv")

# Subset only the ads related to the Democratic presidential candidates

candidates = "BIDEN|WARREN|BERNIE|PETE FOR AMERICA|KAMALA HARRIS FOR THE PEOPLE|CORY 2020|YANG|TULSI NOW|WILLIAMSON|AMY FOR AMERICA|BULLOCK FOR PRESIDENT|JULIAN FOR THE FUTURE|JOHN DELANEY|WAYNE MESSAM|TOM STEYER|GILLIBRAND 2020|BETO FOR AMERICA|DE BLASIO|MIKE GRAVEL|HICKENLOOPER|INSLEE|SETH MOULTON|SWALWELL|TIM RYAN"

ad_to_candidate <- function(Advertiser_Name) {
  case_when(
    str_detect(Advertiser_Name, "BIDEN") ~ "Biden",
    str_detect(Advertiser_Name, "WARREN") ~ "Warren",
    str_detect(Advertiser_Name, "BERNIE") ~ "Sanders",
    str_detect(Advertiser_Name, "PETE") ~ "Buttigieg",
    str_detect(Advertiser_Name, "KAMALA") ~ "Harris",
    str_detect(Advertiser_Name, "CORY") ~ "Booker",
    str_detect(Advertiser_Name, "YANG") ~ "Yang",
    str_detect(Advertiser_Name, "TULSI") ~ "Gabbard",
    str_detect(Advertiser_Name, "AMY") ~ "Klobuchar",
    str_detect(Advertiser_Name, "WILLIAMSON") ~ "Williamson",
    str_detect(Advertiser_Name, "BULLOCK") ~ "Bullock",
    str_detect(Advertiser_Name, "JULIAN") ~ "Castro",
    str_detect(Advertiser_Name, "DELANEY") ~ "Delaney",
    str_detect(Advertiser_Name, "MESSAM") ~ "Messam",
    str_detect(Advertiser_Name, "STEYER") ~ "Steyer",
    str_detect(Advertiser_Name, "GILLIBRAND") ~ "Gillibrand",
    str_detect(Advertiser_Name, "BETO") ~ "O'Rourke",
    str_detect(Advertiser_Name, "DE BLASIO") ~ "De Blasio",
    str_detect(Advertiser_Name, "GRAVEL") ~ "Gravel",
    str_detect(Advertiser_Name, "HICKENLOOPER") ~ "Hickenlooper",
    str_detect(Advertiser_Name, "INSLEE") ~ "Inslee",
    str_detect(Advertiser_Name, "MOULTON") ~ "Moulton",
    str_detect(Advertiser_Name, "SWALWELL") ~ "Swalwell",
    str_detect(Advertiser_Name, "RYAN") ~ "Ryan")
}

advertisers <- advertisers %>% 
  filter(str_detect(Advertiser_Name, candidates)) %>% 
  mutate(candidate = map_chr(Advertiser_Name, ~ad_to_candidate(.x)))

ads <- ads %>% 
  filter(str_detect(Advertiser_Name, candidates)) %>% 
  mutate(candidate = map_chr(Advertiser_Name, ~ad_to_candidate(.x)))

ad_campaigns <- ad_campaigns %>% 
  filter(str_detect(Advertiser_Name, candidates)) %>% 
  mutate(candidate = map_chr(Advertiser_Name, ~ad_to_candidate(.x)))

```

```{r}

# Read in polling data

general <- read_csv("538-polls-data/general.csv")
primaries <- read_csv("538-polls-data/primaries.csv")


general <- general %>% 
  select(poll_id, state, pollster, pollster_id, start_date, end_date, answer, candidate_name, candidate_party, pct) %>% 
  filter(candidate_party == "DEM") 

primaries <- primaries %>% 
  select(poll_id, state, pollster, pollster_id, start_date, end_date, answer, candidate_name, party, pct) %>% 
  filter(party == "DEM")
  
primaries %>% distinct(answer)
```

